---
title: "trump_tweets_statistics"
author: "Chenjie"
date: "5/4/2020"
output: html_document
---
```{r}
rm(list = ls())
getwd()  # returns current working directory
setwd("/Users/chenjiesu/Desktop/Text_as_Data_Assignments/project")  # set working directory
# import libraries
library(tm)
library(SnowballC)
library(slam)
library(xtable)
library(wordcloud)
library(RColorBrewer)
```

```{r}
# get and divide the data
#raw_tweets <- read.csv("trump _tweets/realdonaldtrump.csv", stringsAsFactors = F)
#tweet_data <- raw_tweets[grep("RT ", raw_tweets$content, invert=T),]
#retweet_data <- raw_tweets[grep("RT ", raw_tweets$content),]
#raw_tweets$date <- as.Date(raw_tweets$date)
#date1 <- as.POSIXct(paste("2014-06-16","00:00:00"))
#date2 <- as.POSIXct(paste("2015-06-16","00:00:00"))
#date3 <- as.POSIXct(paste("2016-11-09","00:00:00"))
#date4 <- as.POSIXct(paste("2020-01-22","00:00:00"))
#date5 <- as.POSIXct(paste("2020-04-15","00:00:00"))
#data1 <- interval(date1, date2)
#data2 <- interval(date2, date3)
#data3 <- interval(date3, date4)
#data4 <- interval(date4, date5)
```

##  Part One: Tweet Statistics

The dataset is Donald Trump tweets from July 16, 2015 to November 11, 2016.  He announced his run for the presidency June 16, 2015 so this essentially covers the period while he was running for president.

He tweeted at total of 7375 times, including 456 retweets.  I treated tweets and retweets seperately.


First thing I do is load the Donald Trump tweet data.  Then I feature engineer day of week and time of day to get an insight into Mr Trump's tweeting habits.  I also compute his daily and weekly tweet frequency.


```{r echo=F}

raw_tweets <- read.csv("trump _tweets/realdonaldtrump.csv", stringsAsFactors = F)
tweet_data <- raw_tweets[grep("RT ", raw_tweets$content, invert=T),]
retweet_data <- raw_tweets[grep("RT ", raw_tweets$content),]

tweet_data$hour <- as.numeric(sub(":", "" , substring(tweet_data$date, 1, 2)))
tweet_data$weekday <- weekdays(as.Date(tweet_data$date, '%y-%m-%d'))

tweet_data$timeofday <- tweet_data$Time
tweet_data$timeofday[tweet_data$hour >= 0 & tweet_data$hour <= 3] <- '12AM - 3AM'
tweet_data$timeofday[tweet_data$hour >= 4 & tweet_data$hour <= 7] <- '4AM - 7AM'
tweet_data$timeofday[tweet_data$hour >= 8 & tweet_data$hour <= 11] <- '8AM - 11AM'
tweet_data$timeofday[tweet_data$hour >= 12 & tweet_data$hour <= 15] <- '12PM - 3PM'
tweet_data$timeofday[tweet_data$hour >= 16 & tweet_data$hour <= 19] <- '4PM - 7PM'
tweet_data$timeofday[tweet_data$hour >= 20 & tweet_data$hour <= 23] <- '8PM - 11AM'

# daily frequency
tweet_date <- as.Date(raw_tweets$date, '%y-%m-%d')
tweet_date <- sort(tweet_date, decreasing = F)
curr_date <- tweet_date[1]
nTweets <- 0
cIdx <- 1
date_freq <- vector()
the_date <- vector()
for (idx in 1:length(tweet_date)) {
    if (tweet_date[idx] == curr_date) {
      nTweets <- nTweets + 1
  } else {
    date_freq[cIdx] <- nTweets
    the_date[cIdx] <- curr_date
    cIdx <- cIdx + 1
    while (difftime(tweet_date[idx], curr_date, units='days') > 1) {
      # capture dates with no tweets
      date_freq[cIdx] <- 0
      curr_date <- as.Date((as.numeric(curr_date) + 1), origin = "1970-01-01")
      the_date[cIdx] <- curr_date
      cIdx <- cIdx + 1
    }
    
    nTweets <- 1;
    curr_date <- tweet_date[idx]
  }
}
date_freq[cIdx] <- nTweets
the_date[cIdx] <- curr_date

#weekly frequency

curr_date <- as.Date((as.numeric(the_date[1]) + 7), origin = "1970-01-01")
cIdx <- 1
freq <- 0;
week_freq <- vector()
week_idx <- vector()
for (idx in 1:length(the_date)) {
  if (the_date[idx] < curr_date) {
    freq <- freq + date_freq[idx]
  } else {
    week_freq[cIdx] <- freq
    week_idx[cIdx] <- idx
    cIdx <- cIdx + 1
    freq <- date_freq[idx]
    curr_date <- as.Date((as.numeric(the_date[idx]) + 7), origin = "1970-01-01")
  }
}


```

Is Donald Trump a heavy tweeter?  He tweets on average 15 times a day with a high of 87.  There were only 6 days out of 485 where he idn't tweet.  

```{r echo=F, fig.width=10 }

inc <- floor(length(date_freq)/4)
labidx <- c(1, inc, inc*2, inc *3, length(date_freq))
lablab <- as.Date(the_date[labidx], origin = "1970-01-01")

plot(c(1:length(date_freq)), xaxt="n", date_freq, type="l", xlab="Date", ylab="Number of Tweets", main="Donald Trump Daily Tweet Frequency", col='Red')  
axis(1, at=labidx, labels=lablab)
lines(x=c(0, length(date_freq)), y=rep(mean(date_freq), 2), col='blue')

```

He appears to have slowed down a bit during the second half of his campaign.  

Lets look at his weekly frequency.


```{r echo=F, fig.width=10 }


inc <- floor(length(week_freq)/4)
labidx <- c(1, inc, inc*2, inc *3, length(week_freq))

plot(c(1:length(week_freq)), xaxt="n", week_freq,  type = 'b', pch='+', col = 'red',
     xlab="Date", ylab="Number of Tweets", main="Donald Trump Weekly Tweet Frequency")
axis(1, at=labidx, labels=lablab)
lines(x=c(0, length(week_freq)), y=rep(mean(week_freq), 2), col='blue')

```

Sometime in late April 2016 his frequency dropped.  This is right around the time he clinched the Repuplican nomination.

What time of day is Mr trump most active?  Here's a histogram of the times of each tweet.

```{r echo=F, fig.width=10 }

barplot(table(tweet_data$hour), col="Red", main = "Donald Trump Tweet Frequency by Hour", xlab="Hour of the Day", ylab="Frequency")

```

Mr. Trump doesn't appear to be a morning person, quite possibly because he likes to stay up late and tweet.  His most prolific time is between 2 and 3 AM.  His least prolific between 7AM and 8AM.

Lets have a look at the time of day frequency.


```{r echo=F, fig.width=10 }

tbl <- table(tweet_data$timeofday)
tbl <- c( tbl[3], tbl[5], tbl[2], tbl[4], tbl[6], tbl[1])
barplot(tbl, col="Red", main = "Donald Trump Tweet Frequency by Time of Day", xlab="Time of Day", ylab="Frequency")

```

And we can see he is least prolific in the morning and steadily increaces until he hits his peak after midnight.

Lets have a look at frequency by day of the week.

```{r echo=F, fig.width=10 }

tbl <- table(tweet_data$weekday)
tbl <- c(tbl[2], tbl[6], tbl[7],tbl[5],tbl[1],tbl[3],tbl[4])
barplot(tbl, col="Red", main = "Donald Trump Tweet Frequency by Day of Week")

```

He is most prolific on Tuesdays, and least prolific on Fridays.  He seems to take it easy on the weekend, which appears to last from Friday to Monday.

I was told that Mr. Trump likes to tweet Saturday Mornings at 10 AM.  To verify this I created a chart showing tweet frequency by weekday and time of day.  Smaller circles indicate low frequency and larger circles higher frequencies.


```{r echo=F, fig.width=10 }

## tweet day of week time of day
dColor <- c("Red", "Green", "Blue", "Purple", "Orange", "Dark Red", "Magenta")

tbl <- table(tweet_data$hour, tweet_data$weekday)
tbl <- c(tbl[,2], tbl[,6], tbl[,7],tbl[,5],tbl[,1],tbl[,3],tbl[,4])

ys <- rep(1:7, each=24)
xs <-rep(0:23, 7)
ws <- round(((tbl - min(tbl))*10)/(max(tbl)-min(tbl)))
ws[which(ws == 0)] <- 1;

symbols(y=ys, x=xs, circles =ws  , inches=.25, bg = rep(dColor, each=24), xaxt="n", yaxt="n", 
        main="Donald Trump Tweet Frequency By Weekday and Time of Day", xlab="Time of Day", ylab="Weekday")
axis(1, at=0:23, labels=0:23)
axis(2, at=1:7, labels=c("Monday", "Tuesday", "Wednesdy", "Thursday", "Friday", "Saturday", "Sunday"))

```

And we see that tweet frequency on Saturdays at 10 AM isn't particularily high.  We also see that the Saturday frequecy is reasonably close to the frequency for the other weekdays.  I have to conclude that Saturday at 10AM is not a prime tweeting time for Mr. Trump.



## Word Clouds


What words does Donald Trump tweet most frequently?  A word cloud or 2 should give us some insights.

First I define a function to clean up and normalize the tweet text.  
This involves converting to lower case, removing hash tags, twitter handles, URLs, punctuation, numbers, and stop words.

```{r echo=F}
cleanCorpus <- function(corpus) {
corpus <- tm_map(corpus, content_transformer(tolower))
corpus <- tm_map(corpus, removeNumbers)
#remove retweet tags
corpus <- tm_map(corpus, content_transformer(function(x) gsub("rt @[a-z]*:", "", x)))
#remove hastags
corpus <- tm_map(corpus, content_transformer(function(x) gsub( "#[a-z]([a-z[:punct:]])*", "", x)))
#remove handles
corpus <- tm_map(corpus, content_transformer(function(x) gsub( "@[a-z]([a-z[:punct:]])*", "", x)))
#remove &amp
corpus <- tm_map(corpus, content_transformer(function(x) gsub("&amp", "", x)))
corpus <- tm_map(corpus, removePunctuation)
corpus <- tm_map(corpus, stripWhitespace)
#remove URLs.  By now all thats left is http([a-z]*)
corpus <- tm_map(corpus, content_transformer(function(x) gsub( "http([a-z]*)", "", x)))
#corpus <- tm_map(corpus, stemDocument)
corpus <- tm_map(corpus, removeWords, stopwords("english"))
#corpus <- tm_map(corpus, PlainTextDocument)
return(corpus)
}

```

Let's build a wordcloud from his tweets, excluding retweets, which I'll look at seperately.


```{r echo=F, fig.width=10 }

myCorpus <- Corpus(VectorSource(tweet_data$content))
myCorpus <- cleanCorpus(myCorpus)
pal <- brewer.pal(8, "Dark2")
pal <- rev(pal)
wordcloud(myCorpus, max.words = 200, scale=c(5, .5),random.order = F, col=pal)

```

I notice that Trump and great are 2 of the most popular words.  It would seem that Mr. Trump likes to tweet about himself in the third person and has a bit of an ego. 

Let's do the same thing for his retweets.

```{r echo=F, fig.width=10 }
reCorpus <- Corpus(VectorSource(retweet_data$content))
reCorpus <- cleanCorpus(reCorpus)
wordcloud(reCorpus, max.words = 200, scale=c(5, .5),random.order = FALSE, col=pal)

```

Once again Trump is number one.  It would seem you have a better chance of Mr. Trump retweeting you if you mention him.

Let's have a look at the hashtags he included.

```{r echo=F, fig.width=10 }
tagCorpus <- Corpus(VectorSource(tweet_data$hashtags))
tagCorpus <- tm_map(tagCorpus, content_transformer(function(x) gsub( ";", " ", x)))
tagCorpus <- tm_map(tagCorpus, content_transformer(function(x) gsub( "MakeAmericaGreatAgain", "MAGA", x)))
wordcloud(tagCorpus, max.words = 100, scale=c(5, .5),random.order = F, col=pal)

```

We see the 2 big winners are Trump2016 and MakeAmericaGreatAgain which I've abbreviated as MAGA so it will fit into the wordcloud.  This isn't too surprising since these were his campaign slogans during his presidential run. 
```

